/*!
 * na-gaussian-elimination
 * @see https://github.com/tfoxy/na-gaussian-elimination
 * @version 0.0.1
 * @author Tom√°s Fox <tomas.c.fox@gmail.com>
 * @license MIT
 */
!function(t,i){"use strict";"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.GaussianElimination=i()}(this,function(){"use strict";function t(t){t=t||{};var i=e("pivoting",t);switch(this._pivotingType=i,i){case"partial":this._pivoting=h.bind(this);break;case"scaled":this._pivoting=l.bind(this);break;case"none":this._pivoting=m.bind(this);break;case"avoid zero":this._pivoting=f.bind(this);break;case"complete":this._pivoting=p.bind(this);break;default:throw new k("Unknown pivoting method: "+t.pivoting)}var r=e("lu",t);if(r)this._getLowerMatrixValue=n;else{var o=e("zero",t);this._getLowerMatrixValue=function(){return o}}}function i(i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.prototype.solve=s,t.prototype.forwardElimination=a,t.prototype.backSubstitution=u}function r(){var t={prototype:{on:function(){throw new Error("An EventEmitter library needs to be set using GaussianElimination.setEventEmitter(EventEmitter) method. The /on/ function cannot be used otherwise")},emit:function(t,i){if("error"===t)throw i}}};if("object"==typeof module&&module.exports)try{t=require("events").EventEmitter}catch(i){}return t}function e(i,r){return i in r?r[i]:t.defaultOptions[i]}function o(t){function i(t){this.message=t,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i.prototype.name=t,i}function n(t){return t}function s(t,i){this.emit("solveStart",{matrix:t,result:i});var r=this.forwardElimination(t,i),e=this.backSubstitution(t,i);return r.transformationVector.forEach(function(t,e){x(i,e,t),x(r.transformationVector,e,t)}),this.emit("solveEnd",e),e}function a(t,i){var r=t.length,e=t[0].length,o=Math.min(r,e),n="forward",s="complete"===this._pivotingType?t[0].map(function(t,i){return i}):[],a={matrix:t,result:i,transformationVector:s},u={type:n,system:a};this.emit("eliminationStart",u);for(var m=0;o-1>m;m++){this._pivoting(a,m);var f=t[m][m];if(!f.isZero()){var h={k:m,pivot:f};this.emit("eliminationReduceColumnStart",h);for(var l=m+1;r>l;l++){var p,v=t[l],b=v[m].div(f),d={i:l,k:m,m:b,pivot:f};this.emit("eliminationReduceRowStart",d),v[m]=this._getLowerMatrixValue(b);for(var E=m+1;e>E;E++)p=b.times(t[m][E]),v[E]=v[E].sub(p);p=b.times(i[m]),i[l]=i[l].sub(p),this.emit("eliminationReduceRowEnd",d)}this.emit("eliminationReduceColumnEnd",h)}}return c(t,i,o),this.emit("eliminationEnd",u),a}function u(t,i){var r,e,o,n,s,a=t[0].length,u=t.length,c=u-Math.max(u-a,0),m="back";this.emit("substitutionStart",{type:m,system:{matrix:t,result:i}});var f={matrix:t,solution:i,infiniteSolutions:!1};for(r=c-1;r>=0;r--){if(o=t[r],s=i[r],n=o[r],this.emit("substitutionOperationStart",{i:r}),s.isZero()&&n.isZero())i[r]=s,f.infiniteSolutions=!0;else{for(e=r+1;e<o.length;e++){var h=o[e].times(i[e]);s=s.sub(h)}if(n.isZero()){if(!s.isZero())return this.emit("error",new S("There is no solution for the system (a number multiplied by zero cannot be non-zero)")),f;i[r]=s}else i[r]=s=s.div(n)}this.emit("substitutionOperationEnd",{i:r})}if(a>0){var l=i[c-1];for(r=c;u>r;r++){if(n=t[r][a-1],s=i[r],n.isZero()){if(s.isZero())continue;return this.emit("error",new S("There is no solution for the system (a number multiplied by zero cannot be non-zero)")),f}var p=s.div(n);if(0!==p.cmp(l))return this.emit("error",new S("There is no solution for the system")),f}i.splice(c,Math.max(u-c,0))}return this.emit("substitutionEnd",{type:m,system:f}),f}function c(t,i,r){if(r>0)for(var e=t.length-1,o=r-1,n=o;e>n;++n)t[n][o].isZero()&&(x(t,n,e),x(i,n,e),e-=1)}function m(t,i){var r=t.matrix[i][i];r.isZero()&&this.emit("error",new S("Pivot "+i+" is zero"))}function f(t,i){var r=t.matrix[i][i];r.isZero()&&h.call(this,t,i)}function h(t,i){var r=v(t.matrix,i);g.call(this,t,i,r)}function l(t,i){var r=b(t.matrix,i);g.call(this,t,i,r)}function p(t,i){var r=y(t.matrix,i);g.call(this,t,i,r.i),w.call(this,t,i,r.j)}function v(t,i){for(var r=t[i][i].abs(),e=i,o=i+1;o<t.length;o++){var n=t[o][i].abs();n.cmp(r)>0&&(r=n,e=o)}return e}function b(t,i){for(var r=d(t[i],i),e=i,o=i+1;o<t.length;o++){var n=d(t[o],i);n.cmp(r)>0&&(r=n,e=o)}return e}function d(t,i){var r=E(t,i),e=t[i].abs();return r.isZero()?r:e.div(r)}function E(t,i){for(var r=t[i].abs(),e=i+1;e<t.length;e++){var o=t[e].abs();o.cmp(r)>0&&(r=o)}return r}function y(t,i){var r,e,o=t.length,n=t[0].length,s=t[i][i].abs(),a={i:i,j:i},u=i;for(r=i+1;o>r;r++)e=t[r][u].abs(),e.cmp(s)>0&&(s=e,a={i:r,j:u});for(r=i;o>r;r++)for(u=i+1;n>u;u++)e=t[r][u].abs(),e.cmp(s)>0&&(s=e,a={i:r,j:u});return a}function g(t,i,r){i!==r&&(x(t.matrix,i,r),x(t.result,i,r),this.emit("swapRows",{i:i,j:r}))}function w(t,i,r){i!==r&&(t.matrix.forEach(function(t){x(t,i,r)}),x(t.transformationVector,i,r),this.emit("swapColumns",{i:i,j:r,transformationVector:t.transformationVector}))}function x(t,i,r){var e=t[i];t[i]=t[r],t[r]=e}var S=o("SolutionError"),k=o("OptionsError");return t.defaultOptions={zero:0,pivoting:"partial",lu:!1},t.SolutionError=S,t.OptionsError=k,t.setEventEmitter=i,t.setEventEmitter(r()),t});