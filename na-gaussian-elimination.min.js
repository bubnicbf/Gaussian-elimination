/*!
 * na-gaussian-elimination
 * @see https://github.com/tfoxy/na-gaussian-elimination
 * @version 0.0.4
 * @author Tom√°s Fox <tomas.c.fox@gmail.com>
 * @license MIT
 */
!function(t,i){"use strict";"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.GaussianElimination=i()}(this,function(){"use strict";function t(t){t=t||{},this.setPivoting(o("pivoting",t)),this.setLuFlag(o("lu",t)),this.setZero(o("zero",t))}function i(i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.prototype.solve=f,t.prototype._solve=h,t.prototype.forwardElimination=m,t.prototype._forwardElimination=l,t.prototype.backSubstitution=p,t.prototype._backSubstitution=v,t.prototype.setPivoting=s,t.prototype.setLuFlag=a,t.prototype.setZero=c}function r(){var t={prototype:{on:function(){throw new Error("An EventEmitter library needs to be set using GaussianElimination.setEventEmitter(EventEmitter) method. The /on/ function cannot be used otherwise")},emit:function(t,i){if("error"===t)throw i}}};if("object"==typeof module&&module.exports)try{t=require("events").EventEmitter}catch(i){}return t}function o(i,r){return i in r?r[i]:t.defaultOptions[i]}function e(t){function i(t){this.message=t,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i.prototype.name=t,i}function n(t){return t}function s(t){switch(t){case"partial":this._pivoting=E.bind(this);break;case"scaled":this._pivoting=g.bind(this);break;case"none":this._pivoting=d.bind(this);break;case"avoid zero":this._pivoting=y.bind(this);break;case"complete":this._pivoting=w.bind(this);break;default:throw new T("Unknown pivoting method: "+t)}this._pivotingType=t}function a(t){t?this._getLowerMatrixValue=n:this._getLowerMatrixValue=u.bind(this)}function u(){return this._zero}function c(t){this._zero=t}function f(t,i){try{return this._solve(t,i)}catch(r){return this.emit("error",r),null}}function h(t,i){this.emit("solveStart",{matrix:t,result:i});var r=this._forwardElimination(t,i),o=this._backSubstitution(t,i);return r.transformationVector.forEach(function(t,o){V(i,o,t),V(r.transformationVector,o,t)}),this.emit("solveEnd",o),o}function m(t,i){try{return this._forwardElimination(t,i)}catch(r){return this.emit("error",r),null}}function l(t,i){var r=t.length,o=t[0].length,e=Math.min(r,o),n="forward",s="complete"===this._pivotingType?t[0].map(function(t,i){return i}):[],a={matrix:t,result:i,transformationVector:s},u={type:n,system:a};this.emit("eliminationStart",u);for(var c=0;e-1>c;c++){this._pivoting(a,c);var f=t[c][c];if(!f.isZero()){var h={k:c,pivot:f};this.emit("eliminationReduceColumnStart",h);for(var m=c+1;r>m;m++){var l,p=t[m],v=p[c].div(f),d={i:m,k:c,m:v,pivot:f};this.emit("eliminationReduceRowStart",d),p[c]=this._getLowerMatrixValue(v);for(var y=c+1;o>y;y++)l=v.times(t[c][y]),p[y]=p[y].sub(l);l=v.times(i[c]),i[m]=i[m].sub(l),this.emit("eliminationReduceRowEnd",d)}this.emit("eliminationReduceColumnEnd",h)}}return b(t,i,e),this.emit("eliminationEnd",u),a}function p(t,i){try{return this._backSubstitution(t,i)}catch(r){return this.emit("error",r),null}}function v(t,i){var r,o,e,n,s,a=t[0].length,u=t.length,c=u-Math.max(u-a,0),f="back";this.emit("substitutionStart",{type:f,system:{matrix:t,result:i}});var h={matrix:t,solution:i,infiniteSolutions:!1};for(r=c-1;r>=0;r--){if(e=t[r],s=i[r],n=e[r],this.emit("substitutionOperationStart",{i:r}),s.isZero()&&n.isZero())i[r]=s,h.infiniteSolutions=!0;else{for(o=r+1;o<e.length;o++){var m=e[o].times(i[o]);s=s.sub(m)}if(n.isZero()){if(!s.isZero())throw new O("There is no solution for the system (a number multiplied by zero cannot be non-zero)");i[r]=s}else i[r]=s=s.div(n)}this.emit("substitutionOperationEnd",{i:r,value:s})}if(a>0){var l=i[c-1];for(r=c;u>r;r++){if(n=t[r][a-1],s=i[r],n.isZero()){if(s.isZero())continue;throw new O("There is no solution for the system (a number multiplied by zero cannot be non-zero)")}var p=s.div(n);if(0!==p.cmp(l))throw new O("There is no solution for the system")}i.splice(c,Math.max(u-c,0))}return this.emit("substitutionEnd",{type:f,system:h}),h}function b(t,i,r){if(r>0)for(var o=t.length-1,e=r-1,n=e;o>n;++n)t[n][e].isZero()&&(V(t,n,o),V(i,n,o),o-=1)}function d(t,i){var r=t.matrix[i][i];if(r.isZero())throw new O("Pivot "+i+" is zero")}function y(t,i){var r=t.matrix[i][i];r.isZero()&&E.call(this,t,i)}function E(t,i){var r=_(t.matrix,i);j.call(this,t,i,r)}function g(t,i){var r=x(t.matrix,i);j.call(this,t,i,r)}function w(t,i){var r=Z(t.matrix,i);j.call(this,t,i,r.i),z.call(this,t,i,r.j)}function _(t,i){for(var r=t[i][i].abs(),o=i,e=i+1;e<t.length;e++){var n=t[e][i].abs();n.cmp(r)>0&&(r=n,o=e)}return o}function x(t,i){for(var r=S(t[i],i),o=i,e=i+1;e<t.length;e++){var n=S(t[e],i);n.cmp(r)>0&&(r=n,o=e)}return o}function S(t,i){var r=k(t,i),o=t[i].abs();return r.isZero()?r:o.div(r)}function k(t,i){for(var r=t[i].abs(),o=i+1;o<t.length;o++){var e=t[o].abs();e.cmp(r)>0&&(r=e)}return r}function Z(t,i){var r,o,e=t.length,n=t[0].length,s=t[i][i].abs(),a={i:i,j:i},u=i;for(r=i+1;e>r;r++)o=t[r][u].abs(),o.cmp(s)>0&&(s=o,a={i:r,j:u});for(r=i;e>r;r++)for(u=i+1;n>u;u++)o=t[r][u].abs(),o.cmp(s)>0&&(s=o,a={i:r,j:u});return a}function j(t,i,r){i!==r&&(V(t.matrix,i,r),V(t.result,i,r),this.emit("swapRows",{i:i,j:r}))}function z(t,i,r){i!==r&&(t.matrix.forEach(function(t){V(t,i,r)}),V(t.transformationVector,i,r),this.emit("swapColumns",{i:i,j:r,transformationVector:t.transformationVector}))}function V(t,i,r){var o=t[i];t[i]=t[r],t[r]=o}var O=e("SolutionError"),T=e("OptionsError");return t.defaultOptions={zero:0,pivoting:"partial",lu:!1},t.SolutionError=O,t.OptionsError=T,t.setEventEmitter=i,t.setEventEmitter(r()),t});